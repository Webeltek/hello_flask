{% extends "user_page.jinja2" %}

{% block head %}
  <!-- moment lib 
<script src='https://cdn.jsdelivr.net/npm/moment@2.27.0/min/moment.min.js'></script>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.2/main.js" integrity="sha256-3YcmbVFydbcbP+ax1x6VxV1swYap/YsD/+RFVqSGqxk=" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.2/main.css" integrity="sha256-jLWPhwkAHq1rpueZOKALBno3eKP3m4IMB131kGhAlRQ=" crossorigin="anonymous">
-->

<!-- the moment-to-fullcalendar connector. must go AFTER the moment lib
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/moment@5.5.0/main.global.min.js'></script>
-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!--
<link href="{{ url_for('static',filename = 'jquery.timeline-main/dist/jquery.timeline.min.css') }}" >
<script src="{{ url_for('static',filename = 'jquery.timeline-main/dist/jquery.timeline.min.js') }} "></script>
-->

<link href="https://cdn.jsdelivr.net/gh/ka215/jquery.timeline@main/dist/jquery.timeline.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/gh/ka215/jquery.timeline@main/dist/jquery.timeline.min.js"></script>


<!--
  <script>
  document.addEventListener('DOMContentLoaded',function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar( calendarEl, {
    
    editable:true,
    dayMaxEvents: true,
    headerToolbar: {
     left:'prev,next today',
     center:'title',
     right:' dayGridMonth,timeGridWeek,timeGridDay'
    },
    
    initialDate: '2022-04-07',
    navLinks: true,        
    selectable:true,
    selectMirror: true,
    select: function(arg)
    {
      var title = prompt("Enter Event Title");
      if(title) { 
          var start = FullCalendar.formatDate(arg.start, {
                           month: 'numeric',
                           year: 'numeric',
                           day: 'numeric'           
                            });
          var end = FullCalendar.formatDate(arg.end, {
                           month: 'numeric',
                           year: 'numeric',
                           day: 'numeric'
                            });
          calendar.addEvent({
              title: title,
              start: arg.start,
              end: arg.end,
              allDay: arg.allDay
            })

          $.ajax({
          url:"/services/insert",
          type:"POST",
          data:{title:title, start:start, end:end},
          success:function(data)
            {
            //alert(data)
            alert("Added Successfully");
            calendar.refetchEvents();
            }
          })

      }
    },
    eventResize:function(arg)
    {
     var start = FullCalendar.formatDate(arg.start, "Y-MM-DD HH:mm:ss");
     var end = FullCalendar.formatDate(arg.end, "Y-MM-DD HH:mm:ss");
     var title = arg.title;
     var id = arg.id;
     $.ajax({
      url:"/services/update",
      type:"POST",
      data:{title:title, start:start, end:end, id:id},
      success:function(){
       calendar.refetchEvents();
       alert('Event Update');
      }
     })
    },
      
    eventDrop:function(arg)
    {
     var start = FullCalendar.formatDate(arg.start, "Y-MM-DD HH:mm:ss");
     var end = FullCalendar.formatDate(arg.end, "Y-MM-DD HH:mm:ss");
     var title = arg.title;
     var id = arg.id;
     $.ajax({
      url:"/services/update",
      type:"POST",
      data:{title:title, start:start, end:end, id:id},
      success:function()
      {
       calendar.refetchEvents();
       alert("Event Updated");
      }
     });
    },
  
    eventClick:function(arg)
    {
     if(confirm("Are you sure you want to remove it?"))
     {
      var id = arg.id; <!-- arg.id is missing -->
      $.ajax({
       url:"/services/ajax_delete",
       type:"POST",
       data:{id:id},
       success:function()
       {
        calendar.refetchEvents();
        alert("Event Removed");
       }
      })
     }
    } ,
    
      events: [{% for row in saved_events %}{ id : '{{row.id}}', title : '{{row.title}}', start : '{{row.start}}', end : '{{row.end}}', }, {% endfor %}]
                 

   });
    calendar.render();
    var event = calendar.getEventById(1) ;
    var start = event.start ;
    console.log(start.toISOString()); 
  });
     
  </script>
-->
 

{% endblock head %}

{% block form %}
<!--
  <h2 align="center"><a href="#">Fullcalendar CRUD(Create, Read, Update, Delete) with Python Flask Jquery Ajax and PostgreSQL</a></h2>
    <br />
   <div> {{ url_for('static',filename='ufo.jpg') }} </div>
    <br/>
    <div class="container">
      <div id="calendar"></div>
    </div>
-->         
{% endblock form  %}

{% block calendar %}
   <script>
    $(function () {
      $("#myTimeline").Timeline({
        type  : "bar",
        startDatetime: "2019-03-04 00:00",
        scale: "month",
        rows: 6,
        }).Timeline("initialized", function( self, data ){ 
            console.log([ "user's callback", self, data ])
            });
    });
  
  </script>
  <div id="myTimeline" ></div>

{% endblock calendar %}

